# 目标导向任务系统 — 向导流程需求文档 (v3.1)

> **文档版本**: v3.1
> **更新日期**: 2026-01-01
> **核心变更**: 
> 1. 明确 L1-L4 层级定义 (里程碑 ≠ 月份)。
> 2. 引入“滚动式规划”逻辑：全貌定里程碑，细节只定首个里程碑。
> 3. 增加“多路径并行与资源分配”逻辑。

---

## 1. 核心概念与层级定义 (Hierarchy)

为解决“长期规划不准确”与“短期执行不清晰”的矛盾，系统严格遵循以下 4 层结构：

| 层级 | 名称 | 英文 | 定义 | 颗粒度 | 状态特性 |
|:---:|:---|:---|:---|:---|:---|
| **L1** | **愿景层** | Goal | 用户的终极目标（如“年赚30万”） | 1 年 | 相对固定 |
| **L2** | **路径层** | Path | 赚钱的商业模式/赛道（如“SaaS产品”、“技术博客”） | 项目周期 | 可并行组合 |
| **L3** | **里程碑层** | Milestone | 标志着状态质变的关键节点（如“MVP上线”、“获得首客”） | 阶段 (非固定月份) | **全量规划** (骨架) |
| **L4** | **任务层** | Task | 具体的执行动作（如“设计数据库”、“写文案”） | 2-8 小时 | **仅首个里程碑详细规划** |

> **关键修正**: 
> *   **里程碑 (Milestone)** 是逻辑节点，不是时间单位。一个里程碑可能耗时 2 周，也可能 2 个月。
> *   **滚动规划**: 系统始终保持“当前里程碑”的任务是清晰的。当 Milestone N 即将完成时，系统引导生成 Milestone N+1 的任务。

---

## 2. 详细流程设计 (User Flow)

### Step 0: 目标设定 (Goal)

**目的**: 确立 L1 愿景。

**UI 交互**:
- 输入框: `我今年想赚: ¥ [ 300,000 ]`
- 日期选择: `截止日期: [ 2026-12-31 ]`
- 提示: "这个目标会被分解到各个路径，并反推出每日任务。"

---

### Step 1: 路径选择与资源分配 (Path Selection & Allocation)

**目的**: 确立 L2 路径，并解决**多路径并行**时的资源冲突问题。

**UI 交互**:
1.  **选择路径**: 用户勾选多条路径（支持并行）。
    *   ☑️ **产品型** (做SaaS工具)
    *   ☑️ **内容型** (写技术博客)

2.  **资源分配 (核心新增)**: 
    *   *系统提问*: "你每天能投入多少时间？" -> `[ 4 ]` 小时
    *   *分配精力*:
        *   **产品型**: `[ 70% ]` (约 2.8h/天) —— 主攻方向
        *   **内容型**: `[ 30% ]` (约 1.2h/天) —— 辅助引流
    *   *提示*: "系统将根据此比例，将不同路径的任务穿插安排在同一天。"

---

### Step 2: 收入公式 (Revenue Formula)

**目的**: 为每条 L2 路径建立数学模型。

**UI 交互**:
针对每条选中的路径，分别配置公式。

*   **产品型**: `用户数(1000) × 客单价(249) = 24.9万`
*   **内容型**: `广告单价(500) × 接单数(100) = 5万`
*   **总计**: 24.9 + 5 ≈ 30万 (达标 ✅)

---

### Step 3: 里程碑规划 (Milestone Planning - L3)

**目的**: 生成全年的**骨架**。AI 需生成所有路径的里程碑列表。

**逻辑**:
*   AI 根据路径类型，生成标准的里程碑序列。
*   **不生成具体任务**，只生成里程碑名称、预估周期、关键产出。

**UI 展示 (时间轴视图)**:

```text
【路径 A: SaaS 产品】 (70% 精力)
  [ M1: MVP 开发 ] ----> [ M2: 种子用户 ] ----> [ M3: 公测推广 ]
  (1月1日 - 2月15日)     (2月16日 - 3月30日)    (4月1日 - ...)

【路径 B: 技术博客】 (30% 精力)
  [ M1: 搭建与定位 ] ----> [ M2: 内容填充 ] ----> [ M3: 渠道分发 ]
  (1月1日 - 1月20日)     (1月21日 - ...)
```

*   **用户操作**: 调整里程碑的顺序或时长。

---

### Step 4: 首个里程碑任务拆解 (Detailing Phase - L4)

**目的**: **仅**生成所有路径 **第一个里程碑 (M1)** 的详细任务。

**逻辑**:
1.  **范围锁定**: 锁定 Path A 的 M1 和 Path B 的 M1。
2.  **AI 生成**: 针对这两个里程碑，生成具体的 Task List。
3.  **颗粒度**: 每个任务 2-8 小时。

**UI 展示**:

*   **Path A - M1: MVP 开发** (待办任务: 15个)
    *   ☐ 竞品调研 (4h)
    *   ☐ 数据库设计 (4h)
    *   ...
*   **Path B - M1: 搭建与定位** (待办任务: 5个)
    *   ☐ 注册域名 (1h)
    *   ☐ 选定 Hugo 主题 (2h)
    *   ...

> **注意**: 此时不生成 M2、M3 的任务，避免未来变动导致的浪费。

---

### Step 5: 可行性验证 (Feasibility Check)

**目的**: 校验 L4 任务总工时是否超出 L1/L2 设定的时间限制。

**计算逻辑**:
*   **Path A 需求**: Sum(A.M1 任务工时) vs **Path A 可用** (每天2.8h × 天数)
*   **Path B 需求**: Sum(B.M1 任务工时) vs **Path B 可用** (每天1.2h × 天数)

**报告**:
*   "Path A 任务量过大，预计延期 5 天。"
*   "Path B 时间充裕。"

---

### Step 6: 融合日历生成 (Merged Calendar)

**目的**: 生成最终的可执行日程表。

**逻辑 (穿插排期算法)**:
系统根据**权重比例**，将不同路径的任务“拼图”到每一天。

**示例日历 (1月1日，共4h)**:
*   09:00 - 11:30 **[SaaS]** 竞品调研 (2.5h) —— *占大头*
*   11:30 - 13:00 **[博客]** 注册域名 & 选主题 (1.5h) —— *占小头*

---

## 3. 关键数据结构更新

### paths 表
*   `weight`: integer (权重比例，如 70)

### projects (里程碑) 表
*   `start_date`, `end_date`: date (预估周期)
*   `is_active`: boolean (标记当前是否正在进行详细规划)

### tasks 表
*   `milestone_id`: uuid (关联到里程碑)
*   `original_estimate`: float (原始估时)

---